function MoveResult(t,e,o){this.player=t,this.newPoint=e,this.capturedPoints=o}function Point(t,e){this.row=t,this.column=e,this.getNeighborAt=function(t){switch(t){case Constants.Direction.NORTH:return new Point(this.row-1,this.column);case Constants.Direction.SOUTH:return new Point(this.row+1,this.column);case Constants.Direction.EAST:return new Point(this.row,this.column+1);case Constants.Direction.WEST:return new Point(this.row,this.column-1)}},this.toString=function(){return"("+this.row+", "+this.column+")"},this.equals=function(t){return this.row==t.row&&this.column==t.column},this.isInArray=function(t){for(var e=0;e<t.length;e++)if(this.equals(t[e]))return!0;return!1}}function Territory(t,e){this.points=t||new Array,this.owner=e||Constants.TerritoryOwner.UNKNOWN}function Player(t,e,o){this.color=t,this.pointState=e,this.score=o||0,this.equals=function(t){return this.color==t.color},this.toString=function(){return this.color}}function GameState(t,e,o,n,r){this.boardWidth=t,this.boardHeight=e,this.board=new Array(this.boardHeight);for(var a=0;a<this.boardHeight;a++){this.board[a]=new Array(this.boardWidth);for(var i=0;i<this.boardWidth;i++)this.board[a][i]=Constants.PointState.EMPTY}this.previousBoard=$.extend(!0,[],this.board),this.player1=o,this.player2=n,this.currentPlayer=o,this.moveError,this.status=r||Constants.GameStatus.ACTIVE,this.getPointStateAt=function(t){return this.board[t.row][t.column]},this.setPointStateAt=function(t,e){this.board[t.row][t.column]=e},this.isUniqueBoard=function(){for(var t=0;t<this.boardHeight;t++)for(var e=0;e<this.boardWidth;e++)if(this.board[t][e]!=this.previousBoard[t][e])return!0;return!1},this.getBoardCopy=function(){return $.extend(!0,[],this.board)},this.setBoardCopy=function(t){this.board=$.extend(!0,[],t)}}window.onload=function(){Ish.Go.View.init()};var gGameState,Constants=new function(){this.Color={BLACK:"black",WHITE:"white"},this.Direction={NORTH:"north",EAST:"east",SOUTH:"south",WEST:"west",ALL:["north","east","south","west"]},this.PointState={EMPTY:".",BLACK:"X",WHITE:"O"},this.MoveError={REPEAT:"The attempted move would result in a repeated board state.",OCCUPIED:"The selected intersection is occupied.",SUICIDE:"The attepted move would result in a suicide."},this.TerritoryOwner={UNKNOWN:this.PointState.EMPTY,NEUTRAL:"-",BLACK:this.PointState.BLACK,WHITE:this.PointState.WHITE},this.GameStatus={ACTIVE:"active",IDLE:"idle",ENDED:"ended"}},Ish=Ish||{};Ish.Go=Ish.Go||{},Ish.Go.Logic=new function(){this.isPointInBounds=function(t){return t&&t.row<gGameState.boardHeight&&t.row>=0&&t.column<gGameState.boardWidth&&t.column>=0},this.getTerritory=function(t,e){var o=gGameState.getPointStateAt(t);if(o!=Constants.PointState.EMPTY)return new Territory(this.getChainPoints(t),o);var n=!1;e||(e=new Territory,n=!0),e.points.push(t);for(var r=0;r<Constants.Direction.ALL.length;r++){var a=Constants.Direction.ALL[r],i=t.getNeighborAt(a);if(this.isPointInBounds(i)){var s=gGameState.getPointStateAt(i);s==Constants.PointState.EMPTY?i.isInArray(e.points)||this.getTerritory(i,e):e.owner!=Constants.TerritoryOwner.NEUTRAL&&(e.owner==Constants.TerritoryOwner.UNKNOWN?e.owner=s:e.owner!=s&&(e.owner=Constants.TerritoryOwner.NEUTRAL))}}return n&&e.owner==Constants.TerritoryOwner.UNKNOWN&&(e.owner=Constants.TerritoryOwner.NEUTRAL),e},this.getChainPoints=function(t,e){var o=gGameState.getPointStateAt(t);if(o==Constants.PointState.EMPTY)return new Array;e=e||new Array,e.push(t);for(var n=0;n<Constants.Direction.ALL.length;n++){var r=Constants.Direction.ALL[n],a=t.getNeighborAt(r);if(this.isPointInBounds(a)){var i=gGameState.getPointStateAt(a);o==i&&(a.isInArray(e)||this.getChainPoints(a,e))}}return e},this.getCapturedPoints=function(t){for(var e=new Array,o=0;o<Constants.Direction.ALL.length;o++){var n=Constants.Direction.ALL[o],r=t.getNeighborAt(n);if(this.isPointInBounds(r)){var a=gGameState.getPointStateAt(t),i=gGameState.getPointStateAt(r);i!=a&&i!=Constants.PointState.EMPTY&&(r.isInArray(e)||0!=this.getLibertyPoints(r).length||(e=e.concat(this.getChainPoints(r))))}}return e},this.getLibertyPoints=function(t,e,o){e=e||new Array,o=o||new Array;for(var n=0;n<Constants.Direction.ALL.length;n++){var r=Constants.Direction.ALL[n],a=t.getNeighborAt(r);if(this.isPointInBounds(a)){var i=gGameState.getPointStateAt(t),s=gGameState.getPointStateAt(a);i==s?(e.push(t),a.isInArray(e)||this.getLibertyPoints(a,e,o)):s==Constants.PointState.EMPTY&&(a.isInArray(o)||o.push(a))}}return o},this.isValidMove=function(t,e){if(gGameState.getPointStateAt(t)!=Constants.PointState.EMPTY)return gGameState.moveError=Constants.MoveError.OCCUPIED,!1;var o=!0,n=gGameState.getBoardCopy();gGameState.setPointStateAt(t,e.pointState);var r=this.getCapturedPoints(t);return r.length>0?($.each(r,function(){gGameState.setPointStateAt(this,Constants.PointState.EMPTY)}),gGameState.isUniqueBoard()||(gGameState.moveError=Constants.MoveError.REPEAT,o=!1)):0==this.getLibertyPoints(t).length&&(gGameState.moveError=Constants.MoveError.SUICIDE,o=!1),gGameState.setBoardCopy(n),o},this.move=function(t,e){var o,n=new Point(t,e),r=gGameState.currentPlayer;return gGameState.moveError="",this.isValidMove(n,r)?(gGameState.previousBoard=gGameState.getBoardCopy(),gGameState.setPointStateAt(n,r.pointState),o=this.getCapturedPoints(n),$.each(o,function(){gGameState.setPointStateAt(this,Constants.PointState.EMPTY)}),gGameState.currentPlayer=r==gGameState.player1?gGameState.player2:gGameState.player1,new MoveResult(r,n,o)):null},this.getMarkedBoard=function(){for(var t=gGameState.getBoardCopy(),e=0;e<gGameState.boardHeight;e++)for(var o=0;o<gGameState.boardWidth;o++)if(t[e][o]==Constants.TerritoryOwner.UNKNOWN){var n=this.getTerritory(new Point(e,o));$.each(n.points,function(){t[this.row][this.column]=n.owner})}return t},this.setScores=function(){var t=this.getMarkedBoard(),e=gGameState.player1,o=gGameState.player2;e.score=0,o.score=0;for(var n=0;n<gGameState.boardHeight;n++)for(var r=0;r<gGameState.boardWidth;r++){var a=t[n][r];a==e.pointState?e.score++:a==o.pointState&&o.score++}},this.newGame=function(t,e){gGameState=new GameState(t,e,new Player(Constants.Color.BLACK,Constants.PointState.BLACK),new Player(Constants.Color.WHITE,Constants.PointState.WHITE))}};var Ish=Ish||{};Ish.Go=Ish.Go||{},Ish.Go.View=new function(){var t,e,o=!1,n=19.27,r=new function(){this.boardWidth=19,this.boardHeight=19,this.boardPadding=6,this.pixelWidth=800,this.pixelHeight=800,this.pieceWidth=800/n,this.pieceHeight=800/n,this.imgPieceBlack="dist/assets/img/piece-black.png",this.imgPieceWhite="dist/assets/img/piece-white.png",this.imgFlagBlack="flag-black.png",this.imgFlagWhite="flag-white.png"},a=function(t,e){this.x=t,this.y=e},i=function(t){var e=Ish.Go.View.getPoint(t);e&&!o&&Ish.Go.View.placePiece(e)},s=function(t){var e=Ish.Go.View.getCanvasCoords(t),o=Ish.Go.View.getPoint(t);$("#coords").html("("+e.x+", "+e.y+")"),o?$("#point").html("("+o.row+", "+o.column+")"):$("#point").html("(-, -)")},h=function(){0!=$("#go-canvas").length&&t&&e||(t=document.createElement("canvas"),t.id="go-canvas",$("#board").append(t),t.width=r.pixelWidth,t.height=r.pixelHeight,t.style.background="transparent url(dist/assets/img/board.jpg) no-repeat 0 0",t.addEventListener("click",i,!1),t.addEventListener("mousemove",s),e=t.getContext("2d"))};this.getCanvasCoords=function(e){var o,n;return void 0!=e.pageX&&void 0!=e.pageY?(o=e.pageX,n=e.pageY):(o=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),o-=t.offsetLeft,n-=t.offsetTop,new a(o,n)},this.getPoint=function(t){var e=this.getCanvasCoords(t),o=e.x,n=e.y;if(o-=r.boardPadding,n-=r.boardPadding,0>=o||o>=r.pixelWidth-2*r.boardPadding||0>=n||n>=r.pixelHeight-2*r.boardPadding)return null;var a=new Point(Math.floor(n/r.pieceHeight),Math.floor(o/r.pieceWidth));return a},this.getCoordsFromPoint=function(t){return new a(t.column*r.pieceWidth+r.boardPadding,t.row*r.pieceHeight+r.boardPadding)},this.placePiece=function(t){var e=Ish.Go.Logic.move(t.row,t.column);if(!e){var o="Invalid Move";return gGameState.moveError&&(o+=":\n"+gGameState.moveError),void alert(o)}this.update(e)},this.drawPiece=function(t,o){var n=this.getCoordsFromPoint(t),a=new Image;o==Constants.Color.BLACK?a.src=r.imgPieceBlack:a.src=r.imgPieceWhite,a.onload=function(){e.drawImage(a,n.x,n.y)}},this.drawTerritory=function(t,o){var n=this.getCoordsFromPoint(t),a=new Image;if(o==Constants.TerritoryOwner.BLACK)a.src=r.imgFlagBlack;else{if(o!=Constants.TerritoryOwner.WHITE)return;a.src=r.imgFlagWhite}a.onload=function(){e.drawImage(a,n.x,n.y)}},this.removePieces=function(t){var o;$.each(t,function(){o=Ish.Go.View.getCoordsFromPoint(this),e.clearRect(o.x,o.y,r.pieceWidth,r.pieceHeight)})},this.update=function(t){t&&(this.drawPiece(t.newPoint,t.player.color),this.removePieces(t.capturedPoints),this.drawInfo())},this.redraw=function(t){t||h(),this.drawBoard(),this.drawInfo()},this.drawBoard=function(){e.clearRect(0,0,r.pixelWidth,r.pixelHeight);for(var t,o,n=0;n<gGameState.boardHeight;n++)for(var a=0;a<gGameState.boardWidth;a++)t=new Point(n,a),o=gGameState.getPointStateAt(t),o==Constants.PointState.BLACK?this.drawPiece(t,Constants.Color.BLACK):o==Constants.PointState.WHITE&&this.drawPiece(t,Constants.Color.WHITE)},this.drawMarkedBoard=function(){var t=Ish.Go.Logic.getMarkedBoard();e.clearRect(0,0,r.pixelWidth,r.pixelHeight);for(var o=0;o<gGameState.boardHeight;o++)for(var n=0;n<gGameState.boardWidth;n++)this.drawTerritory(new Point(o,n),t[o][n])},this.drawInfo=function(){$("#turn").html("Current Turn: "+gGameState.currentPlayer.color),Ish.Go.Logic.setScores();var t=gGameState.player1,e=gGameState.player2;$("#score").html("Score:<br>&nbsp;&nbsp;"+t.color+": "+t.score+"<br>&nbsp;&nbsp;"+e.color+": "+e.score)},this.startNewGame=function(){Ish.Go.Logic.newGame(19,19),this.redraw($("go-canvas"))},this.printGameState=function(t){var e=t||"gameState",o="";o+="gGameState = new GameState(\n",o+="	"+gGameState.boardWidth+",\n",o+="	"+gGameState.boardHeight+",\n",o+="	new Player(Constants.Color.BLACK, Constants.PointState.BLACK),\n",o+="	new Player(Constants.Color.WHITE, Constants.PointState.WHITE)\n",o+=");\n",o+="gGameState.currentPlayer = "+(gGameState.currentPlayer==gGameState.player1?"gGameState.player1;\n":"gGameState.player2;\n");for(var n=0;n<gGameState.boardHeight;n++){o+="gGameState.board["+n+"] = [";for(var r=0;r<gGameState.boardWidth;r++)o+='"'+gGameState.board[n][r]+'",';o=o.substring(0,o.length-1),o+="];\n"}for(var n=0;n<gGameState.boardHeight;n++){o+="gGameState.previousBoard["+n+"] = [";for(var r=0;r<gGameState.boardWidth;r++)o+='"'+gGameState.previousBoard[n][r]+'",';o=o.substring(0,o.length-1),o+="];\n"}$("#"+e).html("<textarea>"+o+"</textarea>")},this.toggleMarkedBoard=function(){o?this.drawBoard():this.drawMarkedBoard(),o=!o},this.init=function(){gGameState=new GameState(19,19,new Player(Constants.Color.BLACK,Constants.PointState.BLACK),new Player(Constants.Color.WHITE,Constants.PointState.WHITE)),this.redraw()}};